# ドメインレイヤー

> このディレクトリには、ビジネスロジック・エンティティの定義を記載します。「何を作るか」のルールです。

---

## 概要

GC Storageのドメイン（業務領域）ごとに、エンティティ、ビジネスルール、関係性を定義します。
機能を実装する際は、該当するドメインのドキュメントを参照してください。

---

## ドメイン一覧

| ドメイン | ファイル | 概要 |
|---------|---------|------|
| ファイル | `file.md` | ファイルのアップロード、ダウンロード、バージョン管理 |
| フォルダ | `folder.md` | フォルダの作成、階層構造、移動 |
| ユーザー | `user.md` | ユーザー登録、認証、プロファイル管理 |
| グループ | `group.md` | グループの作成、メンバー管理、ロール |
| 権限 | `permission.md` | アクセス制御、権限付与、継承ルール |
| 共有 | `sharing.md` | 共有リンク、外部共有、アクセス期限 |

> **注記**: 具体的なドメインファイルは必要に応じて作成します。

---

## ドメインドキュメントテンプレート

新しいドメインを追加する際は、以下のテンプレートを使用してください。

```markdown
# {ドメイン名} ドメイン

## 概要
{ドメインの目的と責務を1-2文で説明}

---

## エンティティ

### {エンティティ名}

| 属性 | 型 | 必須 | 説明 |
|-----|-----|------|------|
| id | UUID | Yes | 一意識別子 |
| ... | ... | ... | ... |

**ビジネスルール:**
- ルール1: {説明}
- ルール2: {説明}

---

## 値オブジェクト

### {値オブジェクト名}

| 属性 | 型 | 説明 |
|-----|-----|------|
| ... | ... | ... |

**バリデーション:**
- {検証ルール}

---

## ドメインサービス

### {サービス名}

**責務:** {サービスの責務}

**操作:**
| 操作 | 入力 | 出力 | 説明 |
|-----|------|------|------|
| ... | ... | ... | ... |

---

## 関係性

### エンティティ関係図

{ER図やテキストベースの関係図}

### 関係性ルール

| 関係 | カーディナリティ | 説明 |
|-----|----------------|------|
| ... | ... | ... |

---

## 不変条件

1. {不変条件1}
2. {不変条件2}

---

## ユースケース概要

| ユースケース | アクター | 概要 |
|------------|--------|------|
| ... | ... | ... |
```

---

## ドメイン境界の定義

### 境界の原則

1. **高凝集**
   - 関連するエンティティ・ロジックは同じドメインに
   - ドメイン内で完結する操作を優先

2. **疎結合**
   - ドメイン間の依存を最小化
   - 必要な場合はドメインイベントで連携

3. **ユビキタス言語**
   - ドメイン内で統一された用語を使用
   - コードとドキュメントで同じ用語を使用

### ドメイン間の関係

```
┌─────────────┐      ┌─────────────┐
│    User     │◀────▶│   Group     │
└──────┬──────┘      └──────┬──────┘
       │                    │
       ▼                    ▼
┌─────────────┐      ┌─────────────┐
│ Permission  │◀────▶│   Sharing   │
└──────┬──────┘      └─────────────┘
       │
       ▼
┌─────────────┐      ┌─────────────┐
│    File     │◀────▶│   Folder    │
└─────────────┘      └─────────────┘
```

---

## 命名規則

### エンティティ命名

| 種類 | 規則 | 例 |
|------|------|-----|
| エンティティ | 単数形、パスカルケース | `File`, `User`, `Group` |
| 値オブジェクト | 意味を表す名詞 | `FilePath`, `EmailAddress` |
| ドメインサービス | 動詞 + 名詞 | `PermissionChecker`, `FileValidator` |

### 属性命名

| 種類 | 規則 | 例 |
|------|------|-----|
| 識別子 | `id` または `{entity}_id` | `id`, `folder_id` |
| 日時 | `{action}_at` | `created_at`, `updated_at` |
| フラグ | `is_{状態}` または `has_{属性}` | `is_active`, `has_password` |

---

## 関連ドキュメント

- [アーキテクチャ](../02-architecture/) - 技術設計・システム構成
- [アーキテクチャ/DATABASE.md](../02-architecture/DATABASE.md) - スキーマ定義
- [仕様](../04-specs/) - 機能要件・実装指示
