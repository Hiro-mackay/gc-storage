# アーキテクチャレイヤー

> このディレクトリには、システムの技術設計・構成を定義します。「どう作るか」の指針です。

---

## 概要

GC Storageの技術的な設計方針、システム構成、各コンポーネントの設計を記載します。
新規コンポーネントの追加や設計判断を行う際は、このドキュメントを参照してください。

---

## ドキュメント一覧

| ファイル | 内容 | 参照タイミング |
|---------|------|--------------|
| [SYSTEM.md](./SYSTEM.md) | システム全体構成・データフロー・通信プロトコル | 全体像の把握 |
| [BACKEND.md](./BACKEND.md) | バックエンド設計（Go, Clean Architecture） | バックエンド実装時 |
| [FRONTEND.md](./FRONTEND.md) | フロントエンド設計（React, TanStack） | フロントエンド実装時 |
| [DATABASE.md](./DATABASE.md) | データベース設計・スキーマ・マイグレーション | DB関連作業時 |
| [API.md](./API.md) | API設計方針・エンドポイント規約 | API実装時 |
| [SECURITY.md](./SECURITY.md) | 認証・認可・セキュリティ設計 | セキュリティ関連作業時 |
| [INFRASTRUCTURE.md](./INFRASTRUCTURE.md) | インフラ構成（Kubernetes） | インフラ作業時 |

---

## アーキテクチャ概要

### システム構成

```
┌─────────────────────────────────────────────────────────┐
│                    Kubernetes Cluster                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐  │
│  │  Frontend   │  │  API Server │  │  Background     │  │
│  │  (React)    │  │  (Go)       │  │  Workers        │  │
│  └─────────────┘  └──────┬──────┘  └─────────────────┘  │
│                          │                               │
│         ┌────────────────┼────────────────┐              │
│         ▼                ▼                ▼              │
│  ┌────────────┐  ┌────────────┐  ┌────────────────┐     │
│  │ PostgreSQL │  │   Redis    │  │     MinIO      │     │
│  └────────────┘  └────────────┘  └────────────────┘     │
└─────────────────────────────────────────────────────────┘
```

### レイヤー構成

```
┌─────────────────────────────────────────┐
│          Interface Layer                 │
│  HTTP Handlers, Middleware, DTOs         │
├─────────────────────────────────────────┤
│          UseCase Layer                   │
│  Business Logic Orchestration            │
├─────────────────────────────────────────┤
│          Domain Layer                    │
│  Entities, Value Objects, Services       │
├─────────────────────────────────────────┤
│          Infrastructure Layer            │
│  Repository Impl, External Services      │
└─────────────────────────────────────────┘
```

### 依存関係の方向

```
Interface → UseCase → Domain ← Infrastructure
                        ↑
                   依存性逆転
```

---

## 設計原則

### 基本原則

1. **クリーンアーキテクチャ**
   - 依存関係は常に内側に向かう
   - Domain層は他のレイヤーに依存しない

2. **依存性逆転**
   - Infrastructure層はDomain層のインターフェースを実装
   - 具体的な実装に依存しない

3. **単一責任**
   - 各コンポーネントは明確な責務を持つ
   - 変更理由は1つに限定

### 技術選定の原則

- シンプルさを優先
- 実績のある技術を採用
- オーバーエンジニアリングを避ける

---

## クイックリファレンス

### 新規エンドポイント追加時

```
1. API.md でエンドポイント設計を確認
2. BACKEND.md でHandler/UseCase/Repository構成を確認
3. DATABASE.md でスキーマ変更が必要か確認
```

### 新規画面追加時

```
1. FRONTEND.md でコンポーネント設計を確認
2. API.md で必要なAPIを確認
3. SYSTEM.md でデータフローを確認
```

### 認証・認可の実装時

```
1. SECURITY.md で認証・認可設計を確認
2. API.md で認証ヘッダー仕様を確認
```

---

## 関連ドキュメント

- [開発ポリシー](../01-policies/) - コーディング規約・技術スタック
- [ドメイン](../03-domains/) - ビジネスロジック・エンティティ定義
- [仕様](../04-specs/) - 機能要件・実装指示
