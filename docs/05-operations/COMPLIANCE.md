# GC Storage コンプライアンスガイド

## 概要

本ドキュメントでは、GC Storageにおけるコンプライアンス対応、データ保護ポリシー、およびプライバシー要件について説明します。

---

## 1. データ保護規制

### 1.1 対応する規制

| 規制 | 対象地域 | 主な要件 |
|------|---------|---------|
| GDPR | EU/EEA | データ主体の権利、同意、データ移転 |
| 個人情報保護法 | 日本 | 利用目的の明示、安全管理措置 |
| CCPA | カリフォルニア州 | 消費者の権利、オプトアウト |

### 1.2 GDPRコンプライアンス

#### データ主体の権利

| 権利 | 説明 | GC Storage での実装 |
|------|------|-------------------|
| アクセス権 | 個人データへのアクセス | ユーザーダッシュボードでデータ閲覧可能 |
| 訂正権 | 不正確なデータの訂正 | プロファイル編集機能 |
| 削除権（忘れられる権利） | データの削除要求 | アカウント削除機能 |
| データポータビリティ | データの持ち出し | データエクスポート機能 |
| 処理の制限 | 処理の一時停止 | アカウント一時停止機能 |
| 異議申立権 | 処理への異議 | サポートへの問い合わせ |

#### 法的根拠

| 処理目的 | 法的根拠 |
|---------|---------|
| サービス提供 | 契約の履行 |
| セキュリティログ | 正当な利益 |
| マーケティング | 同意 |
| 法的義務 | 法的義務の遵守 |

---

## 2. データ保持ポリシー

### 2.1 データ種別ごとの保持期間

| データ種別 | 保持期間 | 削除方法 |
|-----------|---------|---------|
| ユーザーアカウント | アカウント存続期間 + 30日 | 自動削除 |
| ファイルデータ | ユーザー削除まで | ユーザーによる削除 |
| ゴミ箱内ファイル | 30日 | 自動物理削除 |
| 監査ログ | 1年 | 自動アーカイブ/削除 |
| アクセスログ | 90日 | 自動削除 |
| セッションデータ | 7日 | 自動失効 |
| バックアップ | 30日 | 自動削除 |

### 2.2 データ削除プロセス

```
┌─────────────────┐
│  削除リクエスト   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  論理削除        │ ← ゴミ箱に移動
│  (Soft Delete)  │
└────────┬────────┘
         │ 30日後
         ▼
┌─────────────────┐
│  物理削除        │ ← 完全削除
│  (Hard Delete)  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  バックアップ     │ ← 30日後に削除
│  からも削除       │
└─────────────────┘
```

### 2.3 データエクスポート

**GDPR データポータビリティ対応:**

```bash
# ユーザーデータのエクスポート（JSON形式）
POST /api/v1/users/me/export

# レスポンス例
{
  "user": {
    "id": "xxx",
    "email": "user@example.com",
    "name": "John Doe",
    "created_at": "2024-01-01T00:00:00Z"
  },
  "files": [
    {
      "id": "yyy",
      "name": "document.pdf",
      "size": 1024,
      "created_at": "2024-01-15T10:00:00Z"
    }
  ],
  "groups": [...],
  "permissions": [...]
}
```

---

## 3. セキュリティ管理

### 3.1 データ暗号化

| データ状態 | 暗号化方式 |
|-----------|-----------|
| 転送中 (In Transit) | TLS 1.3 |
| 保存時 (At Rest) | AES-256 |
| パスワード | bcrypt (cost: 12) |
| セッショントークン | JWT (RS256) |

### 3.2 アクセス制御

```
┌─────────────────────────────────────────────────────────────┐
│                    アクセス制御レイヤー                        │
├─────────────────────────────────────────────────────────────┤
│  Level 1: ネットワーク                                       │
│  - ファイアウォール、WAF、DDoS保護                            │
├─────────────────────────────────────────────────────────────┤
│  Level 2: 認証                                              │
│  - JWT認証、OAuth 2.0、パスワードポリシー                     │
├─────────────────────────────────────────────────────────────┤
│  Level 3: 認可                                              │
│  - PBAC + ReBAC、リソースベースのアクセス制御                  │
├─────────────────────────────────────────────────────────────┤
│  Level 4: 監査                                              │
│  - アクセスログ、操作ログ、異常検知                           │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 脆弱性管理

| 活動 | 頻度 | 担当 |
|------|------|------|
| 依存パッケージスキャン | 日次（自動） | CI/CD |
| コードセキュリティレビュー | PR毎 | 開発チーム |
| ペネトレーションテスト | 年次 | 外部ベンダー |
| セキュリティトレーニング | 年次 | 全従業員 |

---

## 4. 監査ログ

### 4.1 記録する操作

| カテゴリ | 操作 |
|---------|------|
| 認証 | ログイン、ログアウト、パスワード変更 |
| ファイル | 作成、閲覧、ダウンロード、削除 |
| 共有 | 共有リンク作成、アクセス |
| 権限 | 権限付与、権限削除 |
| アカウント | プロファイル変更、アカウント削除 |

### 4.2 監査ログのフォーマット

```json
{
  "timestamp": "2024-01-15T10:30:00Z",
  "event_type": "file.download",
  "actor": {
    "id": "user-123",
    "email": "user@example.com",
    "ip_address": "192.168.1.1",
    "user_agent": "Mozilla/5.0..."
  },
  "resource": {
    "type": "file",
    "id": "file-456",
    "name": "confidential.pdf"
  },
  "result": "success",
  "metadata": {
    "file_size": 1024
  }
}
```

### 4.3 監査ログのアクセス

```bash
# 管理者API経由でのアクセス
GET /api/v1/admin/audit-logs?user_id=xxx&from=2024-01-01&to=2024-01-31

# エクスポート（CSV形式）
GET /api/v1/admin/audit-logs/export?format=csv
```

---

## 5. プライバシー

### 5.1 プライバシーポリシー要素

| 項目 | 内容 |
|------|------|
| 収集するデータ | メールアドレス、名前、ファイルデータ、使用状況 |
| 利用目的 | サービス提供、セキュリティ、改善 |
| 第三者提供 | 原則なし（法的要請を除く） |
| 国外移転 | クラウドサービスの利用に関する説明 |
| 保持期間 | データ種別ごとの期間 |
| ユーザーの権利 | アクセス、訂正、削除、ポータビリティ |
| 連絡先 | privacy@example.com |

### 5.2 Cookie ポリシー

| Cookie 種別 | 目的 | 必須/任意 |
|------------|------|----------|
| セッション | 認証状態の維持 | 必須 |
| 設定 | ユーザー設定の保存 | 任意 |
| 分析 | 利用状況の分析 | 任意（同意必要） |

### 5.3 同意管理

```typescript
// 同意の取得
interface ConsentPreferences {
  essential: true;        // 常に true（必須）
  analytics: boolean;     // 分析Cookie
  marketing: boolean;     // マーケティング
}

// 同意の記録
POST /api/v1/users/me/consent
{
  "analytics": true,
  "marketing": false
}
```

---

## 6. インシデント対応

### 6.1 データ侵害対応手順

```
┌─────────────────┐
│  1. 検知・確認   │
│  (24時間以内)    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  2. 封じ込め    │
│  (即時)         │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  3. 影響評価    │
│  (72時間以内)   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  4. 当局への通知 │  ← GDPR: 72時間以内
│  (該当する場合)  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  5. ユーザーへの │  ← 高リスクの場合
│     通知        │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  6. 再発防止    │
│                 │
└─────────────────┘
```

### 6.2 通知テンプレート

**当局への通知:**
```
- 侵害の性質と影響を受けるデータの種類
- 影響を受けるユーザー数（推定）
- 想定される影響
- 実施した/実施予定の対策
- DPO（データ保護責任者）の連絡先
```

**ユーザーへの通知:**
```
- 侵害の概要（平易な言葉で）
- 影響を受けるデータの種類
- ユーザーが取るべき行動
- 当社の対応
- 問い合わせ先
```

---

## 7. サードパーティ管理

### 7.1 利用サービス

| サービス | 用途 | データ処理 |
|---------|------|-----------|
| AWS/GCP | インフラ | データ保存 |
| MinIO | オブジェクトストレージ | ファイル保存 |
| SendGrid | メール送信 | メールアドレス |
| Sentry | エラー監視 | 匿名化されたエラーデータ |

### 7.2 DPA（Data Processing Agreement）

サードパーティとは以下を含むDPAを締結:

- 処理の対象と範囲
- セキュリティ要件
- データ侵害時の通知義務
- 監査権
- 契約終了時のデータ返却/削除

---

## 8. コンプライアンスチェックリスト

### 8.1 定期確認項目

```
□ プライバシーポリシーの最新性確認（四半期）
□ データ保持期間の遵守確認（月次）
□ アクセスログのレビュー（月次）
□ 権限設定のレビュー（四半期）
□ 脆弱性スキャン結果の確認（月次）
□ サードパーティのコンプライアンス確認（年次）
□ 従業員トレーニング実施確認（年次）
```

### 8.2 GDPR対応状況

| 要件 | 対応状況 | 備考 |
|------|---------|------|
| データ処理の記録 | ✅ | 監査ログで記録 |
| プライバシーバイデザイン | ✅ | 設計時から考慮 |
| データ保護影響評価 | ✅ | 高リスク処理で実施 |
| DPO任命 | - | 規模に応じて検討 |
| データ主体の権利対応 | ✅ | API/UIで対応 |
| 侵害通知手順 | ✅ | 手順書あり |
| 国外移転の適法化 | ✅ | SCC締結 |

---

## 9. 連絡先

| 担当 | 連絡先 |
|------|--------|
| プライバシーに関する問い合わせ | privacy@example.com |
| セキュリティに関する報告 | security@example.com |
| DPO（データ保護責任者） | dpo@example.com |

---

## 関連ドキュメント

- [SECURITY.md](./SECURITY.md) - セキュリティ設計
- [OPERATIONS.md](./OPERATIONS.md) - 運用ガイド
- [INCIDENT_RESPONSE.md](./INCIDENT_RESPONSE.md) - 障害対応

---

## 更新履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2026-01-17 | 1.0.0 | 初版作成 |
