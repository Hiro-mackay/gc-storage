# 機能・要件仕様レイヤー

> このディレクトリには、AIが「今すぐ実装できる」レベルの作業指示書を配置します。

---

## 概要

機能ごとの詳細な仕様書を管理します。各仕様書には以下が含まれます：
- ユーザーストーリー
- 入出力の定義
- 受け入れ基準（テストの元になる）

**粒度**: 1つのプルリクエスト、または1つのコンポーネント単位

---

## 仕様書一覧

| ファイル | 機能 | ステータス |
|---------|------|----------|
| (作成予定) | - | - |

> **注記**: 具体的な仕様書は機能実装時に作成します。

---

## 仕様書テンプレート

新しい機能仕様を作成する際は、以下のテンプレートを使用してください。

````markdown
# {機能名}

## メタ情報

| 項目 | 値 |
|------|-----|
| ステータス | Draft / Ready / In Progress / Done |
| 優先度 | High / Medium / Low |
| 関連ドメイン | file, user, group など |
| 関連Issue | #xxx |

---

## ユーザーストーリー

**As a** {ユーザー種別}
**I want to** {やりたいこと}
**So that** {得られる価値}

### 背景・コンテキスト
{この機能が必要な背景、現状の課題など}

---

## 機能要件

### 画面/UI要件

{画面のモックアップやワイヤーフレームの説明}

```
┌─────────────────────────────────────┐
│  {画面レイアウトのASCIIアート}       │
└─────────────────────────────────────┘
```

### 操作フロー

1. ユーザーが{操作1}
2. システムが{応答1}
3. ...

---

## API仕様

### エンドポイント

`{METHOD} /api/v1/{path}`

### リクエスト

**Headers:**
```
Authorization: Bearer {token}
Content-Type: application/json
```

**Body:**
```json
{
  "field1": "string",
  "field2": 123
}
```

| フィールド | 型 | 必須 | 説明 | バリデーション |
|-----------|-----|------|------|--------------|
| field1 | string | Yes | 説明 | max:255 |
| field2 | number | No | 説明 | min:0 |

### レスポンス

**成功時 (200 OK):**
```json
{
  "data": {
    "id": "uuid",
    "field1": "value"
  }
}
```

**エラー時:**
| コード | 状況 | レスポンス |
|--------|------|----------|
| 400 | バリデーションエラー | `{"error": {...}}` |
| 401 | 認証エラー | `{"error": {...}}` |
| 403 | 権限エラー | `{"error": {...}}` |
| 404 | リソースなし | `{"error": {...}}` |

---

## データ変更

### 新規テーブル/カラム

```sql
-- 必要な場合のみ
ALTER TABLE xxx ADD COLUMN yyy ...;
```

### 影響を受けるテーブル

| テーブル | 変更内容 |
|---------|---------|
| files | xxx カラム追加 |

---

## 受け入れ基準 (Acceptance Criteria)

### 正常系

- [ ] AC1: {条件}のとき、{期待結果}となること
- [ ] AC2: {条件}のとき、{期待結果}となること

### 異常系

- [ ] AC3: {エラー条件}のとき、{エラーメッセージ}が表示されること
- [ ] AC4: {エラー条件}のとき、{適切なHTTPステータス}が返ること

### エッジケース

- [ ] AC5: {境界条件}のとき、{期待結果}となること

---

## 実装メモ

### 実装方針
{実装時の注意点、推奨アプローチなど}

### 影響範囲
{この機能が影響する既存機能}

### 考慮事項
- パフォーマンス: {考慮事項}
- セキュリティ: {考慮事項}
- 後方互換性: {考慮事項}

---

## テスト計画

### ユニットテスト
- [ ] {テストケース1}
- [ ] {テストケース2}

### 統合テスト
- [ ] {テストケース1}

### E2Eテスト
- [ ] {テストケース1}
````

---

## 仕様書の命名規則

| パターン | 用途 | 例 |
|---------|------|-----|
| `{feature}.md` | 単独機能 | `file-upload.md` |
| `{domain}-{action}.md` | ドメイン+操作 | `group-invite.md` |
| `{epic}-{feature}.md` | エピック+機能 | `sharing-public-link.md` |

---

## ステータス定義

| ステータス | 説明 |
|-----------|------|
| Draft | 作成中、レビュー前 |
| Ready | レビュー済み、実装可能 |
| In Progress | 実装中 |
| Done | 実装完了、クローズ |

---

## 仕様書作成のガイドライン

### 良い仕様書の特徴

1. **具体的**
   - 曖昧な表現を避ける
   - 数値や例を明示する

2. **テスト可能**
   - 受け入れ基準は検証可能な形式
   - 「正しく動作する」ではなく「Xの場合にYとなる」

3. **独立**
   - 1つの仕様書で1つの機能が完結
   - 他の仕様書への依存を明記

4. **適切な粒度**
   - 1PR = 1仕様書が理想
   - 大きすぎる場合は分割

### 避けるべきこと

- 実装詳細の過度な指定（「どう作るか」はアーキテクチャ層）
- 曖昧な受け入れ基準
- テスト不可能な要件

---

## 関連ドキュメント

- [ドメイン](../03-domains/) - ビジネスルール・エンティティ定義
- [アーキテクチャ](../02-architecture/) - 技術設計・システム構成
- [アーキテクチャ/API.md](../02-architecture/API.md) - API設計方針
